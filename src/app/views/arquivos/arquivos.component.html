<!-- Loader da página -->
<app-loader [show]="showLoader">
</app-loader>
<div class="arquivos">
  <div class="container-fluid">
    <div class="row">
      <div class="col-6 d-flex">
        <div class="flex-fill">
          <ul class="list-inline">
            <li class="list-inline-item" (click)="handleClickNavigationItem(file.itemPath)"
              *ngFor="let file of navigationExibicao">
              <h3 style="color: black;"> {{file.name}}</h3>
            </li>
          </ul>
          <div class="row d-inline-flex">
            <div class="col-6" (click)="handlerClickedArrow(navigationModeEnum.Back)">
              <fa-icon [icon]="faAngleLeft" size="lg" [ngClass]="hasItemBack() ? 'text-dark pointer' : 'text-danger '">
              </fa-icon>
            </div>
            <div class="col-6" (click)="handlerClickedArrow(navigationModeEnum.Foward)">
              <fa-icon [icon]="faAngleRight" size="lg"
                [ngClass]="hasItemFoward() ? 'text-dark pointer' : 'text-danger '">
              </fa-icon>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-6">
              <mat-form-field appearance="standard">
                <mat-label>Filter</mat-label>
                <input matInput (keyup)="applyFilter($event)" placeholder="Ex. ium" #input>
              </mat-form-field>
            </div>
            <div class="col-6 align-self-center">
              <div class="d-flex flex-row-reverse">
                <div class="icon-remove ps-2">
                  <div *ngIf="canRemove">
                    <fa-icon *ngIf="isLinkLayer; else remove" [icon]="faBan"
                      (click)="handleDisableRemove(modalOpenMode.Disable)" size="lg" [ngClass]="'text-danger pointer'">
                    </fa-icon>
                    <ng-template #remove>
                      <fa-icon [icon]="faTrashAlt" (click)="handleDisableRemove(modalOpenMode.Remove)" size="lg"
                        [ngClass]="'text-danger pointer'">
                      </fa-icon>
                    </ng-template>
                  </div>
                </div>
                <!-- <input type="file" #fileInput class="d-none h-0 w-0" multiple (change)="onFileSelected($event)" /> -->
                <fa-icon *ngIf="!isLinkLayer" [icon]="faFileUpload" (click)="handleEdit()" size="lg"
                  [ngClass]="'text-primary pointer'">
                </fa-icon>
              </div>
            </div>
          </div>

          <table mat-table [dataSource]="dataSource" class="w-100">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef> Nome </th>
              <td mat-cell *matCellDef="let element"> {{element.name}} </td>
            </ng-container>

            <ng-container matColumnDef="size">
              <th mat-header-cell *matHeaderCellDef> Tamanho </th>
              <td mat-cell *matCellDef="let element"> {{element.size}} </td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> Status </th>
              <td mat-cell *matCellDef="let element">
                <ng-container [ngSwitch]="element.status">
                  <span *ngSwitchCase="statusEnum.Disponivel">
                    <fa-icon [icon]="faCircle" size="lg" class="text-success"></fa-icon>
                  </span>
                  <span *ngSwitchCase="statusEnum.NaoDisponivel">
                    <fa-icon [icon]="faCircle" size="lg" class="text-danger"></fa-icon>
                  </span>
                </ng-container>
              </td>
            </ng-container>

            <ng-container matColumnDef="item">
              <td mat-cell *matCellDef="let element"> </td>
            </ng-container>

            <!-- Header -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

            <!-- A busca não bate -->
            <tr class="mat-row" *matNoDataRow>
            </tr>

            <!-- Evento de linha clicada -->
            <tr class="noselect" mat-row (dblclick)="handleDoubleClickedRow(row)"
              (click)="handleClickedRow(row, $event)" *matRowDef="let row; columns: displayedColumns;"
              [ngClass]="{'highlightTableColor': selection.isSelected(row)}"></tr>
          </table>
        </div>
      </div>

      <!-- Preview -->
      <div class="col-6 preview" *ngIf="showPreview && isAnySelected">
        <!-- Detalhes do arquivo -->
        <div class="row">
          <h3>Detalhes</h3>
        </div>
        <form [formGroup]="nickNameForm">
          <div class="row">
            <ul style="list-style-type: none;">
              <li *ngIf="!isNullOrEmpty(previewFile.name)">
                <div class="row">
                  <div class="col-auto">
                    Nome: {{ isEditMode && previewFile.canEdit ? '' : previewFile.name }}
                  </div>
                  <div class="col px-0">
                    <div *ngIf="previewFile.canEdit" class="d-flex">
                      <!--                       <input style="width: fit-content;" type="text"/> -->
                      <input *ngIf="isEditMode" #nickNameInput class="w-50" type="text" formControlName="name"
                        (blur)="unfocusHandler()" (keydown.enter)="enterPressedHandler()" />
                      <div *ngIf="!isEditMode" #buttonTeste class="ps-1" role="button" tabindex="0"
                        (keydown.enter)="buttonHandler()" (click)="buttonHandler()">
                        <fa-icon [icon]="faPen" size="lg"></fa-icon>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li *ngIf="!isNullOrEmpty(previewFile.size)">Tamanho: {{previewFile.size}}</li>
              <li *ngIf="!isNullOrEmpty(previewFile.typeFile)">Tipo de Arquivo: {{previewFile.typeFile}}</li>
              <li *ngIf="!isNullOrEmpty(previewFile.status)">Status: {{previewFile.status}}</li>
              <li *ngIf="!isNullOrEmpty(previewFile.dataCriacao)">Criado em: {{previewFile.dataCriacao}}</li>
              <li *ngIf="!isNullOrEmpty(previewFile.dataExpiracao)">Expira em: {{previewFile.dataExpiracao}}</li>
              <li *ngIf="!isNullOrEmpty(previewFile.downloadLimit)">Limite de downloads: {{previewFile.downloadLimit}}
              </li>
              <li *ngIf="!isNullOrEmpty(previewFile.downloadCount)">Contagem de downloads: {{previewFile.downloadCount}}
              </li>
            </ul>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<ng-template #disableRemoveModalBody>
  <div class="row">
    {{ disableDeleteModalText }}
  </div>
</ng-template>

<ng-template #editModalBody>
  <div class="row">  
    <input type="file" #fileInput class="file-input d-none" multiple (change)="onFileSelected($event)" />
    <a (click)="openFileInput()">
      <fa-icon [icon]="faCircle" size="lg" class="text-danger"></fa-icon>
    </a>
  </div>
</ng-template>